{% extends "radio/base.html" %}
{% block title %}Programas{% endblock %}
{% load static %}
{% block content %}
<div class="flex-grow-1 d-flex flex-column bodyp">

  <div class="container position-relative mt-5 mb-4">

    <div class="titulo-bloco text-center">
      <h2 class="titulo mb-4">Programas</h2>
      <hr class="decorativa mx-auto">
    </div>

      <form method="get" 
            class="d-flex position-absolute search-programas" 
            style="right: 0; top: 0; max-width: 350px;">
        
        <div class="input-group">
          <input class="form-control"
                 type="search"
                 placeholder="Pesquisar"
                 name="f"
                 value="{{ request.GET.f }}">

          <button class="btn btn-outline-secondary" type="submit">
            <i class="bi bi-search"></i>
          </button>
        </div>

      </form>

  </div>



<!-- Card Programa -->
<div class="container my-3">
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">

    {% for programa in programas %}
      <div class="col d-flex">
        <div class="card programa-card w-100 d-flex flex-column border-0 rounded-4 overflow-hidden" style="background:#ffffff;">
          
          {% if programa.banner_programa %}         
            <img src="{{ programa.banner_programa.url }}" class="banner_pro w-100" style="height:220px; object-fit:cover;" alt="Banner {{ programa.nome_programa }}" loading="lazy">
          {% else %}
            <img src="https://via.placeholder.com/600x400" class="w-100" style="height:220px; object-fit:cover;" alt="Banner padrão">
          {% endif %}

          <div class="p-4 d-flex flex-column h-100">

            <h4 class="fw-bold mb-2" style="color:#2f3e46;">{{ programa.nome_programa }}</h4>

            <p class="text-muted mb-3">
              {{ programa.descricao_programa|truncatewords:12 }}
            </p>

            <div class="d-flex align-items-center mt-auto pt-2 justify-content-between">
              
              <div class="d-flex align-items-center">
                <div class="rounded-circle d-flex align-items-center justify-content-center me-2" 
                    style="width:32px; height:32px; background:#dff1e8;">
                  <i class="bi bi-person text-muted"></i>
                </div>
                <div>
                  <small class="text-muted d-block lh-1">Artista  </small>
                  <span class="fw-semibold small"><a href="#"
                      data-bs-toggle="modal"
                      data-bs-target="#modalApresentador{{ programa.apresentador_programa.id }}">
                      {{ programa.apresentador_programa }}
                    </a></span>
                </div>
              </div>

              <a href="{% url 'radio:episodios' programa.id %}" 
                 class="btn btn-outline-success btn-sm rounded-4 px-3">
                Ver mais
              </a>

            </div>

            <form action="{% url 'radio:registrar_curtida' %}" method="POST" class="mt-3">
              {% csrf_token %}
              <input type="hidden" name="id_programa" value="{{ programa.id }}">
              <input type="hidden" name="next" value="{{ request.get_full_path }}">

              <button type="submit" 
                      class="border-0 bg-transparent p-0"
                      style="cursor:pointer;">
                
                {% if user.is_authenticated and user in programa.curtidas.all %}
                  <i class="bi bi-heart-fill text-danger fs-4"></i>
                {% else %}
                  <i class="bi bi-heart fs-4 text-muted"></i>
                {% endif %}
              </button>

              <span class="text-muted small ms-1">
                {{ programa.curtidas.count }}
              </span>
            </form>

          </div>
            
        </div>
      </div>
    {% empty %}
          <div class="col mx-auto">
        {% if filtro %}
          <p class="text-muted text-center">
            Nenhum programa encontrado para
            <strong>"{{ filtro }}"</strong>.
          </p>
          <div class="text-center mb-4 mx-auto">
          <img src="{% static 'radio/img/programa.svg' %}" width="300" class="">

          <div class="text-center">
            <a href="{% url 'radio:programas' %}"
              class="btn btn-outline-success btn-sm mt-2">
              Limpar busca
            </a>
          </div>
        {% else %}
        <div class="text-center mb-4 mx-auto">
          <img src="{% static 'radio/img/programa.svg' %}" width="300" class="">
          <h5>Sem programas cadastrados</h5>
          <p class="text-muted">Volte em breve para conferir as novas atrações!</p>
        </div>
        {% endif %}
      </div>

    {% endfor %}
  </div>
</div>

<!-- Paginação -->
{% if programas.paginator.num_pages > 1 %}
<nav aria-label="Page navigation" class="paginacao">
  <ul class="custom-pagination mb-3">

    {% if programas.has_previous %}
      <li>
        <a href="?page={{ programas.previous_page_number }}" class="arrow-btn">‹</a>
      </li>
    {% else %}
      <li><span class="arrow-btn disabled">‹</span></li>
    {% endif %}

    {% for num in programas.paginator.page_range %}
      {% if programas.number == num %}
        <li><span class="page-number active">{{ num }}</span></li>
      {% else %}
        <li><a href="?page={{ num }}{% if filtro %}&f={{ filtro }}{% endif %}" ></li>
      {% endif %}
    {% endfor %}

    {% if programas.has_next %}
      <li>
        <a href="?page={{ programas.next_page_number }}" class="arrow-btn">›</a>
      </li>
    {% else %}
      <li><span class="arrow-btn disabled">›</span></li>
    {% endif %}

  </ul>
</nav>
</div>
{%endif%}
{% for apresentador in apresentadores %}
<div class="modal fade"
     id="modalApresentador{{ apresentador.id }}"
     tabindex="-1"
     aria-hidden="true">

  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content modal-perfil-clean">

      <!-- Header Roxo -->
      <div class="perfil-header">
        <div class="perfil-header-content">

          <!-- Avatar -->
          <div class="perfil-avatar">
            <img src="{{ apresentador.foto.url }}"
                 alt="{{ apresentador.nome }}">
          </div>

          <!-- Nome -->
          <div class="perfil-header-text">
            <h5>{{ apresentador.nome }}</h5>
          </div>

        </div>

        <button type="button"
                class="btn-close btn-close-white fechar-modal"
                data-bs-dismiss="modal"></button>
      </div>

      <!-- Corpo -->
      <div class="modal-body perfil-body">

       
        <p class="perfil-descricao">
          {{ apresentador.descricao }}
        </p>

      </div>

    </div>
  </div>
</div>
{% endfor %}


{% endblock %}
